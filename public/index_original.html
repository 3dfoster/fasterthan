<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">
  </head>

  <body>
  </body>
    <script>

      var Html = function(title, description, googleID, themeColor, backgroundColor) {
        // Grab DOM objects from rendered HTML page
        var html = document.getElementsByTagName('html')[0]

        // Styling
        html.style.padding = '0px'
        html.style.margin = '0px'
        html.style.overflowY = 'scroll'
        html.style.backgroundColor = backgroundColor

        // Helper function for adding meta tags to Head
        var addMeta = function(name, content) {
          var meta = document.createElement('meta')
          var head = document.getElementsByTagName('head')[0]

          meta.name = name
          meta.content = content

          head.appendChild(meta)
        }

        // Append tags to Head
        document.title = title
        addMeta("description", description)
        addMeta("google-site-verification", googleID)
        addMeta("theme-color", themeColor)

        // return html
      }

      var Body = function(width, font, themeColor, backgroundColor) {
        var body = document.getElementsByTagName('body')[0]

        document.body.style.maxWidth = width + 'px'
        document.body.style.margin = '0px auto'
        document.body.style.textAlign = font.alignment
        document.body.style.fontFamily = font.family
        document.body.style.color = font.color
        document.body.style.backgroundColor = backgroundColor

        // return body
      }
      
      var Header = function(_logo, heading, height, themeColor) {
        var header = document.createElement('header')
        header.style.height = `${height}px`
        header.style.borderBottom = '1px solid #eee'

        var img = document.createElement('img')
        var logo = document.createElement('a')
        img.src = _logo.src
        img.style.cssFloat = 'left'
        img.style.width = `${height}px`
        img.style.backgroundColor = themeColor
        logo.href = _logo.url
        logo.appendChild(img)

        var h1 = document.createElement('h1')
        var home = document.createElement('a')
        h1.style.lineHeight = `${height}px`
        h1.style.margin = '0px'
        home.style.color = themeColor
        home.style.marginLeft = `-${height}px`
        home.style.textDecoration = 'none'
        home.innerText = heading
        home.onclick = function(){ request('/sophia', 'GET', load) }
        home.style.cursor = 'pointer'
        h1.appendChild(home)

        header.appendChild(logo)
        header.appendChild(h1)

        header.logo = function(_logo) {
          img.src = _logo.src
          logo.href = _logo.url
        }

        return header
      }
      
      function request(url, method, callback) {
        var httpRequest = new XMLHttpRequest()

        httpRequest.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200)
            callback(JSON.parse(this.responseText))
        }
        httpRequest.open(method, url)
        httpRequest.send()
      }
      
      function initialize(res) {
        var Person = res
        
        Html(Person.name, `${Person.major} ${Person.degree} at ${Person.school}`, Person.googleID, Person.style.colors.accent, Person.style.colors.background)
        Body(760, Person.style.font, Person.style.colors.accent, 'white')

        var Logo = new Object()
        Logo.url = '/photos'
        Logo.src = Person.photo

        document.body.innerHTML = null
        document.body.appendChild(Header(Logo, Person.style.icon, 64, Person.style.colors.accent))
      }
      
      function load(res) {
        var Person = res
        
        Html(Person.name, `${Person.major} ${Person.degree} at ${Person.school}`, Person.googleID, Person.style.colors.accent, Person.style.colors.background)
        Body(760, Person.style.font, Person.style.colors.accent, 'white')

        var Logo = new Object()
        Logo.url = '/photos'
        Logo.src = Person.photo

        header.logo(Logo)

        document.body.appendChild(Header(Logo, Person.style.icon, 64, Person.style.colors.accent))
      }
      
      window.onload = function() {
        // var Html = new Html()
        // var Body = new Body()


        request('/user', 'GET', initialize)
      }
  </script>
</html>
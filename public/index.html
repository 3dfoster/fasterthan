<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">

    <script type="text/javascript" src="/htjs/ht.js"></script>
    <script src='https://d3js.org/d3.v4.min.js'></script>
    <link rel="stylesheet" type="text/css" href="https://s3-us-west-1.amazonaws.com/fasterthan/font-awesome-4.7.0/css/font-awesome.min.css">
    <link type="text/css" href="/style.css" rel="stylesheet">
  </head>

  <body></body>

  <script>
    var Html = new Html('#fff')
    var Body = new Body(760, 'sans-serif')
    var Header = new Header(64)
    var Ticker = new Ticker(40, 'blue')
    var Main = new Main()
    var Footer = new Footer(40)

    Body.appendChild(Header)
    Body.appendChild(Ticker)
    Body.appendChild(Main)
    Body.appendChild(Footer)

    window.onload = function() {
      console.log(window.location.hash.substr(1))

      var token = window.location.hash.substr(1)

      request('/authorization', 'POST', token, function() {

      })

      Main.style.minHeight = `${Html.height - Header.offsetHeight - Ticker.offsetHeight - Footer.offsetHeight}px`
    }
    
    function loadPage(res) {
      var Person = JSON.parse(res)

      Html.changeTitle(Person.name)
      Html.backgroundColor('#fff')
      Header.logo(Person.photo)
      Header.heading(Person.style.icon, Person.style.colors.accent)
      Header.borderColor('#eee')
      Ticker.arrowColor(Person.style.colors.accent)
      Footer.color(Person.style.colors.accent)

      Header.loading(false)
    }

    function elastic(res) {
      Main.innerHTML = "<div style='display:inline-block;margin:16px auto 8px auto;letter-spacing:4px; font-size: 2em; text-transform: uppercase; font-weight: lighter;'> <span style='background-color: white;'>Elastic</span> <span style='background-color: white;'>Memories</span> </div><svg></svg>"
      
      elasticity()
      Header.loading(false)
    }

    function request(url, method, postData, callback) {
      // Header.loading(true)
      var httpRequest = new XMLHttpRequest()

      httpRequest.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          callback(this.responseText, this.getResponseHeader('content-type'))
          // console.log(this.responseText.split('\n', 1)[0])
          console.log('response recceived')
        }
      }
      httpRequest.open(method, url)
      httpRequest.setRequestHeader("loaded", true)
      httpRequest.send(postData)
      console.log('sent?')
    }
  </script>
</html>
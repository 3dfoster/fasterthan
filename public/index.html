<!DOCTYPE html>
<html>

<head>
  <!--
    Website by David Alexander Foster
    faster@ucdavis.edu
  -->
  <meta name="google-site-verification" content="l3BrFHMCWeUnr4pM3QZXyHk1dxsysnkdWLmEJRw9mYo" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content="#3A5EAB">
  <meta charset="UTF-8">

  <meta name="description" content="Faster than me? David Alexander Foster is faster than you.">

  <link rel="stylesheet" type="text/css" href="/fonts/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/style.css">

  <script type="text/javascript" src="/scripts/ht.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
  <header>
    <a href="/photos">
      <img id="logo" src="/media/avatar_240.png" alt="David Alexander Foster">
    </a>
    <h1>
      <a id="the-f" href="/">F
        <span style="color: #cfcfd6">></span>
      </a>
    </h1>

    <svg id="tray-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px"
      width="16px" height="16px" viewBox="0 0 408 408" xml:space="preserve">
      <g>
        <path d="M204,102c28.05,0,51-22.95,51-51S232.05,0,204,0s-51,22.95-51,51S175.95,102,204,102z M204,153c-28.05,0-51,22.95-51,51    s22.95,51,51,51s51-22.95,51-51S232.05,153,204,153z M204,306c-28.05,0-51,22.95-51,51s22.95,51,51,51s51-22.95,51-51    S232.05,306,204,306z"
        />
      </g>
    </svg>
  </header>
  <script>
    var TrayIcon = document.getElementsByTagName('svg')[0]
    var Header = document.getElementsByTagName('header')[0]
    var theF = document.getElementById('the-f')
    var Overlay = document.createElement('div')
    var Nav = document.createElement('nav')
    var Html = document.documentElement
    var inactiveColor = '#666'
    var activeColor = '#0066ff'
    var opened = false

    Header.loading = function (_isLoading) {
      if (_isLoading)
        theF.className = 'loading'

      else
        theF.classList.remove('loading')
    }

    TrayIcon.style.color = inactiveColor
    Overlay.id = "overlay"

    var home = document.createElement('a')
    home.href = '/'
    home.innerText = 'Home'

    var photos = document.createElement('a')
    photos.href = '/photos'
    photos.innerText = 'Photos'

    var elastic = document.createElement('a')
    elastic.href = '/elastic'
    elastic.innerText = 'Elastic'

    var quotes = document.createElement('a')
    quotes.href = '/quotes'
    quotes.innerText = 'Quotes'

    Nav.appendChild(home)
    Nav.appendChild(photos)
    Nav.appendChild(elastic)
    Nav.appendChild(quotes)

    Overlay.addEventListener('click', removeOverlay)

    TrayIcon.addEventListener('click', function () {
      if (opened == false) {
        Header.appendChild(Nav)
        document.documentElement.appendChild(Overlay)
        TrayIcon.style.color = activeColor

        window.addEventListener('scroll', removeOverlay)
        opened = true
      }
    })

    function removeOverlay() {
      if (opened) {
        // Remove Overlay from HTML document
        document.documentElement.removeChild(document.documentElement.lastChild)
        // Remove Nav from Header
        Header.removeChild(Header.lastChild)
        TrayIcon.style.color = inactiveColor

        window.removeEventListener('scroll', removeOverlay)
        opened = false
      }
    }
  </script>

  <div id="overflow">
    <aside>
    </aside>
  </div>
  <script>
    var Aside = document.getElementsByTagName('aside')[0]
    var Main = document.getElementsByTagName('main')[0]
    var Header = document.getElementsByTagName('header')[0]
    var Overflow = document.getElementById('overflow')

    var asideHeight = 40
    var noGradient = 'box-shadow: none'
    var scrollbarHeight = Aside.offsetHeight - Aside.clientHeight
    Aside.style.height = asideHeight + scrollbarHeight + 'px'
    Overflow.style.height = asideHeight + 'px'

    Aside.addQuote = function (quote) {
      Aside.innerText = quote
    }

    gradient()
    Aside.onscroll = function () {
      gradient()
    }
    window.addEventListener('resize', function () {
      if (Aside.scrollLeft + Aside.scrollWidth - Aside.clientWidth == 0)
        Aside.style.cssText += noGradient
      else gradient()
    })

    function gradient() {
      Aside.style.cssText += 'box-shadow: #888 -' + maxGrad(Aside.scrollWidth - Aside.clientWidth - Aside.scrollLeft) + 'px 0px 40px -40px inset, #888 ' + maxGrad(Aside.scrollLeft) + 'px 0px 40px -40px inset'
    }
    function maxGrad(val) {
      if (val >= 56) return 56
      else return val
    }
  </script>

  <main></main>

  <footer>
    <a href="mailto:faster@ucdavis.edu" class="fa fa-fw fa-envelope-o"></a>
    <a href="https://www.instagram.com/_u/the.t.u.r.n" class="fa fa-fw fa-instagram"></a>
    <a href="https://gitlab.com/dfoster" class="fa fa-fw fa-gitlab"></a>
    <a href="https://github.com/fasterthan" class="fa fa-fw fa-github"></a>
  </footer>
  <script>
    var Main = document.getElementsByTagName('main')[0]
    var Header = document.getElementsByTagName('header')[0]
    var Overflow = document.getElementById('overflow')
    var Footer = document.getElementsByTagName('footer')[0]

    var OverflowHeight = 0
    if (Overflow) OverflowHeight = Overflow.offsetHeight

    stickyFooter()

    window.addEventListener('resize', function () {
      stickyFooter()
    })
    function stickyFooter() {
      Main.style.minHeight = document.documentElement.clientHeight - Header.offsetHeight - OverflowHeight - Footer.offsetHeight + 'px'
    }
  </script>
</body>
<script>
  var Main = document.getElementsByTagName('main')[0]
  window.onload = load(location.pathname)

  function load(url) {
    switch (url) {
      case '/photos':
        get('/api/photos', function (_photos) {
          photos(_photos)
        })
        break

      case '/elastic':
        Header.loading(true)
        elastic()
      break

      case '/quotes':
        get('/api/quotes', function (_quotes) {
          quotes(_quotes)
        })
        get('/api/quotes/faster', function (quote) {
          var Ticker = new Ticker()
          Aside.addQuote(quote)
        })
        break

      default:
        get('/api/resume', function (resume) {
          var Ticker = new Ticker()
          home(resume)
        })
        get('/api/quotes/faster', function (quote) {
          Aside.addQuote(quote)
        })
        break
    }
  }

  window.onpopstate = function () {
    load(location.pathname)
  }

  function home(res) {
    Main.innerHTML = res

    window.history.pushState('', 'Home', '/')
    Header.loading(false)
  }

  function quotes(res) {
    Main.innerHTML = res

    window.history.pushState('', 'Quotes', '/quotes')
    Header.loading(false)
  }

  function photos(res) {
    var object = JSON.parse(res)
    var instagramPhotos = ""
    Main.textContent = ''

    for (let i = 0; i < object.data.length; i++) {
      var tmp = document.createElement('img')
      tmp.style.cursor = 'pointer'
      tmp.className = 'ig'
      tmp.src = object.data[i].images.thumbnail.url
      tmp.onclick = function () { location.href = object.data[i].link }
      Main.appendChild(tmp)
    }

    window.history.pushState('', 'Photos', '/photos')
    Header.loading(false)
  }

  function elastic() {
    // Bubble chart inspired by https://bl.ocks.org/mbostock/4063269
    var canvas = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
    var headerDimensions = Main.getBoundingClientRect()
    canvasWidth = headerDimensions.width
    canvasHeight = canvasWidth * 1.25 + 56 // Instagram portrait photos are 1080*1350 for a 1.25 ratio

    canvas.setAttribute("height", canvasHeight)
    canvas.setAttribute("width", canvasWidth)
    canvas.style.display = 'block'
    canvas.style.margin = 'auto'

    Main.appendChild(canvas)

    var svg = d3.select(canvas),
      width = +svg.attr("width"),
      height = +svg.attr("height")

    var format = d3.format(",d")

    var pack = d3.pack()
      .size([width, height])
      .padding(1)

    d3.tsv('/api/elastic/data', function (d) {
      d.comments = +d.comments
      d.likes = Math.pow(d.likes, 8 / 5) // Raise likes by exponent of 1.6 to emphasize differencee between like counts 
      d.ln = +d.ln
      return d
    }, function (error, classes) {
      if (error) throw error

      var root = d3.hierarchy({ children: classes })
        .sum(function (d) { return d.likes })
        .each(function (d) {
          if (thumbnailUrl = d.data.thumbnailUrl) {
            var thumbnailUrl, i = thumbnailUrl.lastIndexOf(".")
            d.thumbnailUrl = thumbnailUrl
            d.package = thumbnailUrl.slice(0, i)
            d.class = thumbnailUrl.slice(i + 1)
          }
          if (Url = d.data.Url) {
            var Url, i = Url.lastIndexOf(".")
            d.Url = Url
            d.package = Url.slice(0, i)
            d.class = Url.slice(i + 1)
          }
        })

      var node = svg.selectAll(".node")
        .data(pack(root).leaves())
        .enter().append("g")
        .attr("class", "node")
        .attr("transform", function (d) { return "translate(" + d.x + "," + d.y + ")" })
        .on('click', function (d) {

          var imgOverlay = document.createElement('div')
          imgOverlay.style.position = 'absolute'
          imgOverlay.style.top = 0
          imgOverlay.style.width = '100%'
          imgOverlay.style.height = '100%'
          imgOverlay.style.backgroundColor = '#fff'

          var closeButton = document.createElement('img')
          closeButton.src = '/media/close_button.png'
          closeButton.style.width = '48px'
          closeButton.style.cssFloat = 'right'
          closeButton.style.marginTop = '-5px'
          closeButton.onclick = function () { Main.removeChild(Main.lastChild) }

          var img = document.createElement('img')
          img.src = d.Url
          img.style.width = '100%'

          imgOverlay.appendChild(img)
          imgOverlay.appendChild(closeButton)

          Main.appendChild(imgOverlay)
        })

      node.append("clipPath")
        .attr("id", function (d) { return "clip-" + d.thumbnailUrl })
        .append("circle")
        .attr("r", function (d) { return d.r })

      node.append("a")
        .append("image")
        .attr("clip-path", function (d) { return "url(#clip-" + d.thumbnailUrl + ")" })
        .attr("xlink:href", function (d) { return d.thumbnailUrl })
        .attr("x", function (d) { return -d.r })
        .attr("y", function (d) { return -d.r })
        .attr("width", function (d) { return d.r * 2 })
        .attr("height", function (d) { return d.r * 2 })
    })
    Header.loading(false)
  }

  (function (i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
      (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date(); a = s.createElement(o),
      m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
  })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga')

  ga('create', 'UA-100430191-1', 'auto')
  ga('send', 'pageview')
</script>
</html>